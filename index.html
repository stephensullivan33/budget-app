<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget</title>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#121212;color:#fff}
.container{padding:16px;max-width:420px;margin:auto}
h1,h2,h3{text-align:center;margin:10px 0}
button,input,select{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:none;font-size:16px}
button{background:#2ecc71;color:#000;font-weight:bold}
input,select{background:#1e1e1e;color:#fff}
.card{background:#1e1e1e;padding:10px;border-radius:6px;margin-top:6px}
.row{display:flex;justify-content:space-between;align-items:center}
.bill{color:#e74c3c}
.income{color:#2ecc71}
.alert{background:#1e1e1e;border-left:4px solid #f1c40f;padding:8px;margin-top:8px}
.small{font-size:12px;opacity:.8}
hr{border:none;border-top:1px solid #333;margin:16px 0}
</style>
</head>

<body>
<div class="container">

<h1>Dashboard</h1>

<div id="dailyAlert"></div>

<h2>Quick Expense</h2>
<select id="qCat">
  <option>Groceries</option>
  <option>Gas</option>
  <option>Misc</option>
</select>
<input id="qAmt" type="number" placeholder="Amount">
<button onclick="quickExpense()">Add</button>

<hr>

<h2>Accounts</h2>
<input id="accName" placeholder="Account name">
<input id="accBal" type="number" placeholder="Starting balance">
<button onclick="addAccount()">Add Account</button>
<div id="accounts"></div>

<hr>

<h2>Category Rules</h2>
<input id="ruleKey" placeholder="Keyword (e.g. Walmart)">
<select id="ruleCat">
  <option>Groceries</option>
  <option>Gas</option>
  <option>Subscriptions</option>
  <option>Misc</option>
</select>
<button onclick="addRule()">Add Rule</button>
<div id="rules"></div>

<hr>

<h2>Import Bank CSV</h2>
<input type="file" accept=".csv" onchange="importCSV(this.files[0])">

</div>

<script>
const today=new Date().toISOString().slice(0,10)

let expenses=JSON.parse(localStorage.getItem('expenses'))||[]
let accounts=JSON.parse(localStorage.getItem('accounts'))||[]
let rules=JSON.parse(localStorage.getItem('rules'))||[]

function quickExpense(){
  if(!qAmt.value) return
  expenses.push({amount:+qAmt.value,category:qCat.value,date:today})
  localStorage.setItem('expenses',JSON.stringify(expenses))
  qAmt.value=''
  localStorage.setItem('lastEntry',today)
  render()
}

function addAccount(){
  if(!accName.value||!accBal.value) return
  accounts.push({name:accName.value,balance:+accBal.value})
  localStorage.setItem('accounts',JSON.stringify(accounts))
  accName.value=accBal.value=''
  render()
}

function addRule(){
  if(!ruleKey.value) return
  rules.push({key:ruleKey.value.toLowerCase(),cat:ruleCat.value})
  localStorage.setItem('rules',JSON.stringify(rules))
  ruleKey.value=''
  render()
}

function importCSV(file){
  const reader=new FileReader()
  reader.onload=e=>{
    const lines=e.target.result.split('\n')
    lines.slice(1).forEach(l=>{
      const cols=l.split(',')
      if(cols.length<3) return
      const desc=cols[1].toLowerCase()
      const amt=Math.abs(Number(cols[2]))
      let cat='Misc'
      rules.forEach(r=>{if(desc.includes(r.key)) cat=r.cat})
      expenses.push({amount:amt,category:cat,date:cols[0]})
    })
    localStorage.setItem('expenses',JSON.stringify(expenses))
    render()
  }
  reader.readAsText(file)
}

function render(){
  // Daily reminder
  const last=localStorage.getItem('lastEntry')
  dailyAlert.innerHTML= last!==today
    ? `<div class="alert">You haven’t logged spending today</div>`:'';

  // Accounts
  accountsDiv.innerHTML=''
  accounts.forEach(a=>{
    const spent=expenses.reduce((t,e)=>t+e.amount,0)
    accountsDiv.innerHTML+=`
      <div class="card row">
        <span>${a.name}</span>
        <strong>$${(a.balance-spent).toFixed(2)}</strong>
      </div>`
  })

  // Rules
  rulesDiv.innerHTML=''
  rules.forEach(r=>{
    rulesDiv.innerHTML+=`<div class="small">${r.key} → ${r.cat}</div>`
  })
}

const accountsDiv=document.getElementById('accounts')
const rulesDiv=document.getElementById('rules')

render()
</script>
</body>
</html>
