<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget</title>

<style>
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#121212;
  color:#fff;
}
.container {
  padding:16px;
  max-width:420px;
  margin:auto;
}
h1,h2 {
  text-align:center;
}
input,select,button {
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:6px;
  border:none;
  font-size:16px;
}
input,select {
  background:#1e1e1e;
  color:#fff;
}
button {
  background:#2ecc71;
  color:#000;
  font-weight:bold;
}
.bill { color:#e74c3c; }
.income { color:#2ecc71; }
.calendar {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
  margin-top:10px;
}
.day {
  background:#1e1e1e;
  padding:6px;
  min-height:60px;
  font-size:12px;
}
.alert {
  background:#333;
  padding:8px;
  border-left:4px solid #e74c3c;
  margin-top:8px;
}
</style>
</head>

<body>
<div class="container">
<h1>Monthly Budget</h1>

<h2>Monthly Income</h2>
<input type="number" id="income">

<h2>Add Income</h2>
<input id="incName" placeholder="Source">
<input id="incAmount" type="number" placeholder="Amount">
<input id="incDate" type="date">
<button onclick="addIncome()">Add Income</button>

<h2>Add Bill</h2>
<input id="billName" placeholder="Bill">
<input id="billAmount" type="number" placeholder="Amount">
<input id="billDate" type="date">
<button onclick="addBill()">Add Bill</button>

<h2>Alerts</h2>
<div id="alerts"></div>

<h2>Calendar</h2>
<div class="calendar" id="calendar"></div>

<button onclick="exportCalendar()">Export to iOS Calendar</button>
</div>

<script>
let bills = JSON.parse(localStorage.getItem('bills'))||[];
let incomes = JSON.parse(localStorage.getItem('incomes'))||[];

function addBill(){
  bills.push({name:billName.value,amount:+billAmount.value,date:billDate.value});
  localStorage.setItem('bills',JSON.stringify(bills));
  render();
}

function addIncome(){
  incomes.push({name:incName.value,amount:+incAmount.value,date:incDate.value});
  localStorage.setItem('incomes',JSON.stringify(incomes));
  render();
}

function render(){
  const cal=document.getElementById('calendar');
  const alerts=document.getElementById('alerts');
  cal.innerHTML='';
  alerts.innerHTML='';

  const now=new Date();
  const year=now.getFullYear();
  const month=now.getMonth();
  const first=new Date(year,month,1);
  const start=first.getDay();
  const days=new Date(year,month+1,0).getDate();

  for(let i=0;i<start;i++) cal.innerHTML+='<div></div>';

  for(let d=1;d<=days;d++){
    const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    let html=`<div class="day"><strong>${d}</strong>`;
    bills.filter(b=>b.date===dateStr).forEach(b=>{
      html+=`<div class="bill">${b.name}</div>`;
      if((new Date(b.date)-now)/(86400000)<=3){
        alerts.innerHTML+=`<div class="alert">Bill due soon: ${b.name}</div>`;
      }
    });
    incomes.filter(i=>i.date===dateStr).forEach(i=>{
      html+=`<div class="income">${i.name}</div>`;
    });
    html+='</div>';
    cal.innerHTML+=html;
  }
}

function exportCalendar(){
  let ics='BEGIN:VCALENDAR\nVERSION:2.0\n';
  [...bills.map(b=>({...b,type:'Bill'})),...incomes.map(i=>({...i,type:'Income'}))]
    .forEach(e=>{
      ics+=`BEGIN:VEVENT\nSUMMARY:${e.type}: ${e.name}\nDTSTART:${e.date.replace(/-/g,'')}T090000\nEND:VEVENT\n`;
    });
  ics+='END:VCALENDAR';
  const blob=new Blob([ics],{type:'text/calendar'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='budget.ics';
  a.click();
}

document.getElementById('income').value=localStorage.getItem('income')||0;
render();
</script>
</body>
</html>
